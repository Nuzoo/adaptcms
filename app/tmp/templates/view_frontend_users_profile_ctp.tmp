<?php $this->Html->addCrumb('Profile', null) ?>
<?php $this->set("title_for_layout", $user['username'] . "'s Profile") ?>

<h1>
	<?php echo $user['username'] ?>'s Profile
</h1>

<ul id="profile-tabs" class="nav nav-tabs left" style="margin-bottom:0">
	<li class="active">
		<a href="#main" data-toggle="tab">Details</a>
	</li>
	<?php if ( !empty($articles)): ?>
		<li>
			<a href="#articles" data-toggle="tab">Articles</a>
		</li>
	<?php endif ?>
	<?php if ( !empty($comments)): ?>
		<li>
			<a href="#comments" data-toggle="tab">Comments</a>
		</li>
	<?php endif ?>
	<li>
		<a href="<?php echo $this->View->url('messages_index') ?>">Messages</a>
	</li>
    <!--nocache-->
	<?php if ($this->Session->check("Auth.User.username")): ?>
		<li class="pull-right">
			<a href="<?php echo $this->View->url('user_edit') ?>">Edit Your Profile</a>
		</li>
	<?php endif ?>
    <!--/nocache-->
</ul>

<div id="myTabContent" class="tab-content well">
	<div class="tab-pane fade active in" id="main">
		<dl class="dl-horizontal">
			<dt>
				Username
			</dt>
			<dd>
				<?php echo $user['username'] ?>
			</dd>

			<dt>
				Email
			</dt>
			<dd>
				<a class="deobfuscate" href="<?php echo $this->View->obfuscateEmail($user, true) ?>" rel="nofollow"><?php echo $this->View->obfuscateEmail($user) ?></a>
			</dd>

			<dt>
				Status
			</dt>
			<dd>
				<?php if ( !empty($user['status'])): ?>
					Active
				<?php else: ?>
					Non-Active
				<?php endif ?>
			</dd>

			<dt>
				Signed Up
			</dt>
			<dd>
				<?php echo $this->Admin->time($user['created']) ?>
			</dd>

			<dt>
				Last Login
			</dt>
			<dd>
				<?php echo $this->Admin->time($user['login_time']) ?>
			</dd>

			<dt>
				Role
			</dt>
			<dd>
				<?php echo $role['title'] ?>
			</dd>

			<?php if ( !empty($field_data)): ?>
				<?php foreach($field_data as $index => $value): ?>
					<dt>
						<?php echo Inflector::humanize($index) ?>
					</dt>
					<dd>
						<?php echo $value ?>
					</dd>
				<?php endforeach ?>
			<?php endif ?>
		</dl>
	</div>

	<?php if ( !empty($articles)): ?>
		<div class="tab-pane" id="articles">
			<h3>Last 10 Articles</h3>

			<ul>
				<?php foreach($articles as $index => $article): ?>
					<li>
						<a href="<?php echo $this->View->url('article_view', $article) ?>" target="_blank">
							<?php echo $article['title'] ?>
						</a> ( <strong><?php echo $article['Category']['title'] ?></strong> )
					</li>
				<?php endforeach ?>
			</ul>
		</div>
	<?php endif ?>

	<?php if ( !empty($comments)): ?>
		<div class="tab-pane" id="comments">
			<h3>Last 10 Comments</h3>

			<ul class="unstyled">
				<?php foreach($comments as $index => $comment): ?>
					<li>
						@ <?php echo $this->Admin->time($comment['created'], 'words') ?> -
						<a href="<?php echo $this->View->url('article_view', $article) ?>#comment_<?php echo $comment['id'] ?>" target="_blank">view comment</a>

						<em>
							<?php echo $this->Text->truncate($comment['comment_text'], 150) ?>
						</em>

						<div class="clearfix"></div><br />
					</li>
				<?php endforeach ?>
			</ul>
		</div>
	<?php endif ?>
</div>